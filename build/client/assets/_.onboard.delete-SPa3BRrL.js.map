{"version":3,"file":"_.onboard.delete-SPa3BRrL.js","sources":["../../../app/routes/_withNav+/_withSideBar+/_manage+/user+/_.onboard.delete.tsx"],"sourcesContent":["import { DeleteButton } from '@components/ui/Buttons';\nimport ErrorReport from '@components/ui/ErrorReport';\nimport {\n  ExclamationTriangleIcon,\n} from '@heroicons/react/24/outline';\nimport { Attribute } from '@lib/utils';\nimport { handleActionError } from '@lib/utils/utils.server';\nimport {\n  type ActionFunctionArgs,\n  json,\n  type LoaderFunctionArgs,\n} from '@remix-run/node';\nimport { Form, useLoaderData, useNavigate } from '@remix-run/react';\nimport { requireUser } from '@services/user.server';\nimport { jsonWithError, redirectWithSuccess } from 'remix-toast';\nimport { z } from 'zod';\nimport { deleteAccount, getUser } from './.server/user.queries';\nimport { Dialog, DialogPanel } from '@headlessui/react';\nimport React from 'react';\n\nexport async function loader({ request }: LoaderFunctionArgs) {\n  await requireUser(request, {\n    permissions: Attribute.MEMBERS_READWRITEDELETE,\n  });\n\n  const searchParams = new URL(request.url).searchParams;\n  const userId = searchParams.get('userId');\n\n  console.log(searchParams, userId);\n\n  if (!userId) throw new Error('userId is required');\n\n  const user = await getUser(userId);\n\n  return json({ user });\n}\n\nexport async function action({ request }: ActionFunctionArgs) {\n  const orgParam = new URL(request.url).searchParams.get('org');\n  const updateAccountStatus = z.object({\n    userId: z.string(),\n    _action: z.literal('delete'),\n  });\n  try {\n    await requireUser(request, {\n      options: { redirectOnFailure: false },\n      permissions: Attribute.MEMBERS_READWRITEDELETE,\n    });\n\n    const { userId } = updateAccountStatus.parse(\n      Object.fromEntries((await request.formData()).entries())\n    );\n\n    await deleteAccount(userId);\n\n    return redirectWithSuccess(\n      `/user/onboard${orgParam ? `?org=${orgParam}` : ''}`,\n      'Account deleted!'\n    );\n  } catch (e) {\n    return handleActionError(e, 'Account could not be deleted');\n  }\n}\n\nexport default function DeleteAccountPage() {\n  const { user } = useLoaderData<typeof loader>();\n  const navigate = useNavigate();\n\n  return (\n    <Dialog as=\"div\" className=\"relative z-10\" open={true} onClose={() => { navigate(-1); }}>\n      <div className=\"fixed inset-0 bg-gray-500 bg-opacity-75\" />\n      <div className=\"fixed inset-0 z-10 w-screen overflow-y-auto\">\n        <div className=\"flex rounded-xl min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0\">\n          <DialogPanel className=\"relative transform rounded-lg bg-white rounded-t-xl text-left shadow-xl sm:my-8 sm:w-full sm:max-w-2xl\">\n            <Form method=\"post\">\n              <input type=\"hidden\" name=\"userId\" value={user.id} />\n              <div className=\"relative bg-white rounded-t-xl p-2 pb-4\">\n                <div className=\"flex flex-col items-center justify-center mt-8\">\n                  <ExclamationTriangleIcon className=\"w-10 h-10 stroke-red-600\" />\n                  <h1 className=\"text-red-600 text-2xl\">\n                      Delete Account\n                  </h1>\n                </div>\n              </div>\n              <div className=\"bg-gray-200 pb-3 rounded-b-xl\">\n                <div className=\"flex flex-col justify-center items-center p-5 gap-3\">\n                  <h2 className=\"mb-2 text-md font-semibold text-gray-900 dark:text-white\">\n                      Are you sure you want to delete{' '}\n                    <span className=\"bg-gray-400/60 px-2 py-1 rounded-lg text-lg\">\n                      {user.name}'s\n                    </span>{' '}\n                      account?\n                  </h2>\n                  <p>Please enter the word <span className=\"bg-gray-400/60 px-2 py-0.5 rounded-lg\">delete</span> to confirm.</p>\n                  <input type=\"text\" required pattern=\"delete\" className=\"block text-sm invalid:border-red-300 valid:border-green-500 rounded-md border-gray-300 shadow-sm focus:border-primary-400 focus:ring focus:ring-primary-200 focus:ring-opacity-50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500\" />\n                </div>\n                <div className=\"flex items-center justify-center p-2\">\n                  <DeleteButton\n                    type=\"submit\"\n                    name=\"_action\"\n                    value=\"delete\"\n                    className=\"rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto\">\n                      Delete Account\n                  </DeleteButton>\n                  <button type=\"button\" onClick={() => { navigate(-1); }} className=\"rounded-md bg-white px-3 py-2 text-sm font-semibold text-zinc-800 shadow-sm hover:bg-neutral-300 sm:ml-3 sm:w-auto\">Cancel</button>\n                </div>\n              </div>\n            </Form>\n          </DialogPanel>\n        </div>\n      </div>\n    </Dialog>\n  );\n}\n\nexport const ErrorBoundary = ErrorReport;\n"],"names":["DeleteAccountPage","user","useLoaderData","navigate","useNavigate","jsxs","Dialog","as","className","open","onClose","children","jsx","DialogPanel","Form","method","type","name","value","id","ExclamationTriangleIcon","required","pattern","DeleteButton","onClick","ErrorBoundary","ErrorReport"],"mappings":"8yBAgEA,SAAwBA,GAAoB,CACpC,KAAA,CAAEC,KAAAA,CAAK,EAAIC,EAA6B,EACxCC,EAAWC,EAAY,EAG3B,OAAAC,EAAAA,KAACC,GAAOC,GAAG,MAAMC,UAAU,gBAAgBC,KAAM,GAAMC,QAASA,IAAM,CAAEP,EAAS,EAAE,CACjF,EAAAQ,SAAA,CAACC,EAAA,IAAA,MAAA,CAAIJ,UAAU,yCAA0C,CAAA,EACxDI,EAAA,IAAA,MAAA,CAAIJ,UAAU,8CACbG,eAAC,MAAI,CAAAH,UAAU,6FACbG,SAAAC,EAAA,IAACC,GAAYL,UAAU,yGACrBG,SAACN,EAAA,KAAAS,EAAA,CAAKC,OAAO,OACXJ,SAAA,CAAAC,EAAA,IAAC,SAAMI,KAAK,SAASC,KAAK,SAASC,MAAOjB,EAAKkB,EAAI,CAAA,QAClD,MAAI,CAAAX,UAAU,0CACbG,SAACN,EAAA,KAAA,MAAA,CAAIG,UAAU,iDACbG,SAAA,CAACC,EAAA,IAAAQ,EAAA,CAAwBZ,UAAU,0BAA2B,CAAA,EAC7DI,EAAA,IAAA,KAAA,CAAGJ,UAAU,wBAAwBG,SAEtC,gBAAA,CAAA,CAAA,CACF,CAAA,CACF,CAAA,EACAN,EAAA,KAAC,MAAI,CAAAG,UAAU,gCACbG,SAAA,CAACN,EAAA,KAAA,MAAA,CAAIG,UAAU,sDACbG,SAAA,CAACN,EAAA,KAAA,KAAA,CAAGG,UAAU,2DAA2DG,SAAA,CAAA,kCACrC,IAClCN,EAAAA,KAAC,OAAK,CAAAG,UAAU,8CACbG,SAAA,CAAKV,EAAAgB,KAAK,IAAA,CACb,CAAA,EAAQ,IAAI,UAAA,CAEd,CAAA,SACC,IAAE,CAAAN,SAAA,CAAA,yBAAuBC,EAAA,IAAA,OAAA,CAAKJ,UAAU,wCAAwCG,SAAM,QAAA,CAAA,EAAO,cAAA,CAAY,CAAA,EAC1GC,EAAA,IAAC,SAAMI,KAAK,OAAOK,SAAQ,GAACC,QAAQ,SAASd,UAAU,0PAA2P,CAAA,CAAA,CACpT,CAAA,EACAH,EAAA,KAAC,MAAI,CAAAG,UAAU,uCACbG,SAAA,CAAAC,EAAA,IAACW,EAAA,CACCP,KAAK,SACLC,KAAK,UACLC,MAAM,SACNV,UAAU,gHAAgHG,SAAA,gBAAA,CAE5H,EACCC,EAAA,IAAA,SAAA,CAAOI,KAAK,SAASQ,QAASA,IAAM,CAAErB,EAAS,EAAE,CAAG,EAAGK,UAAU,qHAAqHG,SAAM,QAAA,CAAA,CAAA,CAC/L,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CACF,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAEJ,CAEO,MAAMc,EAAgBC"}