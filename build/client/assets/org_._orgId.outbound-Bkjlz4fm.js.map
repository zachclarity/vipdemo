{"version":3,"file":"org_._orgId.outbound-Bkjlz4fm.js","sources":["../../../app/routes/_withNav+/_withSideBar+/_manage+/org_.$orgId.outbound.tsx"],"sourcesContent":["import { DeleteButton, LinkButton } from '@components/ui/Buttons';\nimport ErrorReport from '@components/ui/ErrorReport';\nimport PageHeader from '@components/ui/PageHeader';\nimport { Dialog, Transition } from '@headlessui/react';\nimport { useManageLayoutData } from '@lib/hooks/useMatchesData';\nimport { Attribute } from '@lib/utils';\nimport { handleActionError } from '@lib/utils/utils.server';\nimport type { ActionFunctionArgs, LoaderFunctionArgs } from '@remix-run/node';\nimport { json } from '@remix-run/node';\nimport type { FetcherWithComponents } from '@remix-run/react';\nimport { Outlet, useFetcher, useLoaderData } from '@remix-run/react';\nimport { requireUser, requireUserAsObject } from '@services/user.server';\nimport { Fragment, useRef, useState } from 'react';\nimport { jsonWithSuccess } from 'remix-toast';\nimport z from 'zod';\nimport { cancelMemberMove, getOutboundMembers } from './.server/org.queries';\n\nexport const loader = async ({ request, params }: LoaderFunctionArgs) => {\n  const { currentOrg } = await requireUserAsObject(request, {\n    permissions: Attribute.MOVES_READ,\n  });\n\n  const { orgId } = params;\n  if (!orgId) throw new Error('org id is required.');\n  const outbound = await getOutboundMembers(orgId);\n\n  return json({ outbound });\n};\n\nexport const action = async ({ request }: ActionFunctionArgs) => {\n  const deleteSchema = z.object({\n    id: z.string().min(1),\n    _action: z.string().regex(/delete/),\n  });\n\n  try {\n    await requireUser(request, {\n      permissions: Attribute.MOVES_READWRITEDELETE,\n      options: {\n        redirectOnFailure: false,\n      },\n    });\n\n    const { id } = deleteSchema.parse(\n      Object.fromEntries(await request.formData())\n    );\n\n    await cancelMemberMove(id);\n\n    return jsonWithSuccess({ status: 'success' }, 'Move cancelled.');\n  } catch (e) {\n    return handleActionError(e, 'There was an error cancelling the move.');\n  }\n};\n\nfunction ConfirmNavigation({\n  fetcher,\n  showModal,\n  setShowModal,\n  userName,\n  idRef,\n}: {\n  fetcher: FetcherWithComponents<any>;\n  showModal: boolean;\n  setShowModal: React.Dispatch<React.SetStateAction<boolean>>;\n  idRef: React.MutableRefObject<HTMLInputElement | null>;\n  userName: string;\n}) {\n  return (\n    <Transition.Root show={true} as={Fragment}>\n      <Dialog\n        as=\"div\"\n        className=\"relative z-10\"\n        open={showModal}\n        onClose={() => setShowModal(false)}>\n        <Transition.Child\n          as={Fragment}\n          enter=\"ease-out duration-300\"\n          enterFrom=\"opacity-0\"\n          enterTo=\"opacity-100\"\n          leave=\"ease-in duration-200\"\n          leaveFrom=\"opacity-100\"\n          leaveTo=\"opacity-0\">\n          <div className=\"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity\" />\n        </Transition.Child>\n        <div className=\"fixed inset-0 z-10 w-screen overflow-y-auto\">\n          <div className=\"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0\">\n            <Transition.Child\n              as={Fragment}\n              enter=\"ease-out duration-300\"\n              enterFrom=\"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95\"\n              enterTo=\"opacity-100 translate-y-0 sm:scale-100\"\n              leave=\"ease-in duration-200\"\n              leaveFrom=\"opacity-100 translate-y-0 sm:scale-100\"\n              leaveTo=\"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95\">\n              <Dialog.Panel className=\"relative transform rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg\">\n                <div className=\"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4 mb-5\">\n                  <Dialog.Title\n                    as=\"h3\"\n                    className=\"text-base font-semibold leading-6 text-gray-900 mb-3\">\n                    Are you sure you want to cancel {userName}'s move?\n                  </Dialog.Title>\n                </div>\n                <div className=\"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6\">\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      fetcher.submit(\n                        {\n                          id: idRef.current?.value ?? '',\n                          _action: 'delete',\n                        },\n                        { method: 'POST' }\n                      );\n                      setShowModal(false);\n                    }}\n                    className=\"inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto\">\n                    Yes\n                  </button>\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowModal(false)}\n                    className=\"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto\">\n                    No\n                  </button>\n                </div>\n              </Dialog.Panel>\n            </Transition.Child>\n          </div>\n        </div>\n      </Dialog>\n    </Transition.Root>\n  );\n}\n\nconst OutboundMembers = () => {\n  const { outbound } = useLoaderData<typeof loader>();\n  const { orgBeingViewed } = useManageLayoutData();\n  const deleteFetcher = useFetcher();\n  const userIdRef = useRef<HTMLInputElement>(null);\n  const [showConfirmModal, setShowConfirmModal] = useState(false);\n  const [modalUserName, setModalUserName] = useState<string>('');\n\n  const handleClick = (userName: string) => {\n    setModalUserName(userName);\n    setShowConfirmModal(true);\n  };\n\n  return (\n    <>\n      <PageHeader\n        org={orgBeingViewed}\n        pageTitle=\"Outbound Members\"\n        navigateTo=\"outbound\"/>\n      {outbound.length > 0 ? (\n        <table className=\"text-left table-auto w-full border-neutral-300 border-1\">\n          <thead>\n            <tr className=\"border-b border-black\">\n              <th className=\"pl-3\">Name</th>\n              <th>Move Type</th>\n              <th>Next Organization</th>\n              <th>Last Updated</th>\n              <th></th>\n            </tr>\n          </thead>\n          <tbody>\n            {outbound\n              .sort((a, b) => a.name.localeCompare(b.name))\n              .map((user) => {\n                const updatedAt = new Date(user.updatedAt).toDateString();\n                return (\n                  <tr\n                    key={user.id}\n                    className=\"table-row border-b even:bg-zinc-50\">\n                    <td className=\"py-4 pl-3\">{user.name}</td>\n                    <td>{user.moveType}</td>\n                    <td>{user.nextOrg?.name}</td>\n                    <td>{updatedAt}</td>\n                    <td className=\"text-center\">\n                      <LinkButton\n                        className=\"my-2\"\n                        to={`/org/${orgBeingViewed.uuid}/outbound/${user.id}/edit`}>\n                        Edit\n                      </LinkButton>\n                      <deleteFetcher.Form className=\"inline\" method=\"post\">\n                        <input\n                          type=\"hidden\"\n                          ref={userIdRef}\n                          id=\"id\"\n                          name=\"id\"\n                          value={user.id}/>\n                        <DeleteButton\n                          className=\"ml-3\"\n                          name=\"_action\"\n                          value=\"delete\"\n                          type=\"button\"\n                          onClick={() => handleClick(user.name)}>\n                          Cancel\n                        </DeleteButton>\n                      </deleteFetcher.Form>\n                    </td>\n                  </tr>\n                );\n              })}\n          </tbody>\n        </table>\n      ) : (\n        `No members to show.`\n      )}\n      {showConfirmModal ? (\n        <ConfirmNavigation\n          fetcher={deleteFetcher}\n          showModal={showConfirmModal}\n          setShowModal={setShowConfirmModal}\n          userName={modalUserName}\n          idRef={userIdRef}/>\n      ) : null}\n      <Outlet />\n    </>\n  );\n};\n\nexport const ErrorBoundary = ErrorReport;\nexport default OutboundMembers;\n"],"names":["ConfirmNavigation","fetcher","showModal","setShowModal","userName","idRef","Transition","Root","show","as","Fragment","children","jsxs","Dialog","className","open","onClose","jsx","Child","enter","enterFrom","enterTo","leave","leaveFrom","leaveTo","Panel","Title","type","onClick","submit","id","current","value","_action","method","OutboundMembers","outbound","useLoaderData","orgBeingViewed","useManageLayoutData","deleteFetcher","useFetcher","userIdRef","useRef","showConfirmModal","setShowConfirmModal","useState","modalUserName","setModalUserName","handleClick","PageHeader","org","pageTitle","navigateTo","length","sort","a","b","name","localeCompare","map","user","updatedAt","Date","toDateString","moveType","nextOrg","LinkButton","to","uuid","Form","ref","DeleteButton","Outlet","ErrorBoundary","ErrorReport"],"mappings":"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"}