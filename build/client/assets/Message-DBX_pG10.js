import{r as n,j as r}from"./index-CGKE_yqd.js";import"./index-CPe-BBEd.js";import{a as I}from"./components-BktKjo96.js";import{F as R}from"./UserIcon-D6mIire7.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="347df61e-e0ee-4084-999a-1f2dfc36c367",e._sentryDebugIdIdentifier="sentry-dbid-347df61e-e0ee-4084-999a-1f2dfc36c367")}catch{}})();function B({title:e,titleId:t,...s},f){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const E=n.forwardRef(B),N=(e,t)=>{const[s,f]=n.useState(!1);return n.useEffect(()=>{const c=()=>{const d=t.current,a=e.current;if(d&&a){const o=d.getBoundingClientRect(),l=a.getBoundingClientRect(),u=d.scrollTop,h=d.scrollLeft,m=o.top+u,p=o.left+h,w=m+o.height,x=p+o.width,y=l.top+u,b=l.left+h,v=y+l.height,j=b+l.width;f(v>m&&y<w&&j>p&&b<x)}},i=t.current;return i&&i.addEventListener("scroll",c),c(),()=>{i==null||i.removeEventListener("scroll",c)}},[e,t]),s};function D({message:e,containerRef:t,loggedInUser:s,markRead:f}){var w;const c=n.useRef(null),[i,d]=n.useState(!1),[a,o]=n.useState(null),l=N(c,t);n.useState([]);const[u,h]=n.useState(null),m=n.useRef(!0);n.useEffect(()=>(m.current=!0,()=>{m.current=!1,u&&clearInterval(u)}),[u]),n.useEffect(()=>{if(i&&a){const x=window.setInterval(()=>{if(Date.now()-a>=2e3&&!e.readBy.includes(s)){if(m.current)try{f()}catch(b){console.error("Error in markRead:",b)}clearInterval(x)}},100);h(x)}else u&&clearInterval(u)},[i,a,e.readBy,s,f]),n.useEffect(()=>{l?i||(d(!0),o(Date.now())):i&&(d(!1),o(null))},[l,i]);const p=()=>{if(e.postedById===s)return"bg-gray-300";if(e.isDenied)return"bg-red-400";if(l&&e.readBy.includes(s))return"bg-blue-300";if(l&&!e.readBy.includes(s))return"bg-blue-500"};return r.jsxs("li",{className:`mb-1.5 flex ${e.postedById===s?"justify-end":"justify-start"}`,ref:c,children:[e.postedById===s?r.jsx(E,{className:"h-7 w-7 min-w-7 min-h-7 mr-2"}):r.jsx(R,{className:"h-7 w-7 min-w-7 min-h-7 mr-2"}),r.jsx("div",{children:r.jsx("div",{className:`flex w-80 gap-2 px-2 py-0.5 rounded-br-md rounded-tr-md rounded-bl-md ${p()}`,children:r.jsxs("div",{className:"flex flex-col w-full",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("p",{className:"mr-2",children:(w=e.postedBy)==null?void 0:w.name}),r.jsx("p",{className:"text-sm text-gray-500",children:new Date(e.datePosted).toLocaleString()})]}),r.jsx("span",{className:"",style:{overflowWrap:"break-word"},children:e.message})]})})})]})}function L({loggedInUser:e,comments:t,status:s,isModal:f=!1}){const c=n.useRef(null),i=I();function d(){let a=[];t.forEach(l=>{l.readBy.includes(e)||a.push(l.id)});const o=new FormData;o.append("commentId",encodeURIComponent(JSON.stringify(a))),o.append("userId",e),o.append("_action","markRead"),i.submit(o,{method:"POST"})}return r.jsx("div",{className:`${f?"max-h-[75vh] h-52 ":"rounded-xl "}min-h-20 overflow-auto bg-slate-200 shadow-inner border-[1px] border-slate-300`,ref:c,children:r.jsx("ul",{className:"p-2",children:!t||t.length===0?r.jsx("li",{className:"flex justify-center items-center h-full text-lg text-gray-500",children:"No messages"}):t.map(a=>r.jsx(D,{message:a,containerRef:c,loggedInUser:e,markRead:d},a.id))})})}export{L as M};
//# sourceMappingURL=Message-DBX_pG10.js.map
