{"version":3,"file":"template_._templateId.item.create-Bhv81P4M.js","sources":["../../../app/routes/_withNav+/_withSideBar+/_manage+/template_.$templateId.item.create.tsx"],"sourcesContent":["import ErrorReport from '@components/ui/ErrorReport';\nimport {\n  Input,\n  Form,\n  Label,\n} from '@components/ui';\nimport { Modal } from '@components/ui/modals';\nimport { RTEProvider } from '@components/ui/RichText/Editor';\nimport { Attribute } from '@lib/utils';\nimport type { ActionFunctionArgs } from '@remix-run/node';\nimport { useLoaderData, useParams } from '@remix-run/react';\nimport { requireUser } from '@services/user.server';\nimport { AuthorizationError } from 'remix-auth';\nimport { jsonWithError, redirectWithSuccess } from 'remix-toast';\nimport z, { ZodError } from 'zod';\nimport type { createTemplateItemLoader } from './.server/template.queries';\nimport { createTemplateItem } from './.server/template.queries';\n\nexport { createTemplateItemLoader as loader } from './.server/template.queries';\n\nexport const action = async ({ request, params }: ActionFunctionArgs) => {\n  if (!params.templateId) throw new Error('Template ID is required.');\n\n  const itemCreateSchema = z.object({\n    templateId: z.literal(params.templateId),\n    name: z.string().min(1),\n    description: z.string().optional(),\n    requiredRole: z.string().min(1),\n    forHasDependents: z.union([\n      z.literal('on').transform(() => true),\n      z.literal(undefined).transform(() => false),\n    ]),\n    forDormResidents: z.union([\n      z.literal('on').transform(() => true),\n      z.literal(undefined).transform(() => false),\n    ]),\n    forHasEFMP: z.union([\n      z.literal('on').transform(() => true),\n      z.literal(undefined).transform(() => false),\n    ]),\n  });\n\n  try {\n    await requireUser(request, {\n      options: {\n        redirectOnFailure: false,\n      },\n      permissions: Attribute.TEMPLATES_READWRITE,\n    });\n\n    const {\n      templateId,\n      name,\n      description,\n      requiredRole: requiredRoleId,\n      forHasDependents,\n      forHasEFMP,\n      forDormResidents,\n    } = itemCreateSchema.parse(\n      Object.fromEntries((await request.formData()).entries())\n    );\n\n    await createTemplateItem({\n      name,\n      description,\n      requiredRoleId,\n      templateId,\n      forDormResidents,\n      forHasEFMP,\n      forHasDependents,\n    });\n  } catch (err) {\n    if (err instanceof Error) {\n      if (err instanceof AuthorizationError) {\n        return jsonWithError(\n          { status: 'error', error: 'Authorization Error.' },\n          'User is not authorized.'\n        );\n      }\n      if (err instanceof ZodError) {\n        err.issues.forEach((issue) =>\n          console.error(\n            `There was an error validating on item creation!\\n${issue.path} - ${issue.message}`\n          )\n        );\n        return jsonWithError(\n          {\n            status: 'error',\n            error: 'There was an error adding the item.',\n            items: err.issues,\n          },\n          'There was an error adding the item.'\n        );\n      }\n      return jsonWithError(\n        { status: 'error', error: err.message },\n        'There was an error adding the item.'\n      );\n    }\n  }\n\n  return redirectWithSuccess(`/template/${params.templateId}`, 'Item Added!');\n};\n\nconst CreateItem = () => {\n  const { templateId } = useParams();\n  const { roles } = useLoaderData<typeof createTemplateItemLoader>();\n\n  return (\n    <Modal>\n      <RTEProvider>\n        <Form method=\"post\">\n          <Input.Hidden name=\"templateId\" value={templateId}/>\n          <div className=\"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4 mb-5\">\n            <Modal.Title>Create New Item</Modal.Title>\n            <Form.Row>\n              <Label htmlFor=\"name\">Name</Label>\n              <Input.Text name=\"name\" />\n            </Form.Row>\n            <Form.Row>\n              <Label htmlFor=\"description\">Description</Label>\n              <Input.RichText name=\"description\" limit={2500} />\n            </Form.Row>\n            <Form.Row>\n              <Label>Role Required</Label>\n              <Input.Select options={roles} valueKey=\"uuid\" name=\"requiredRole\"></Input.Select>\n            </Form.Row>\n            <Form.Row>\n              <Label.Heading>Questions</Label.Heading>\n              <Input.CheckboxGroup>\n                <Input.Checkbox\n                  label=\"For Members that are Dorm Residents\"\n                  name=\"forDormResidents\"/>\n                <Input.Checkbox\n                  label=\"For Members with Dependents\"\n                  name=\"forHasDependents\"/>\n                <Input.Checkbox\n                  label=\"For Members with Dependents that qualify for EFMP\"\n                  name=\"forHasEFMP\"/>\n              </Input.CheckboxGroup>\n            </Form.Row>\n          </div>\n          <Modal.Buttons link={`/template/${templateId}`} value=\"create\">\n          Create Item\n          </Modal.Buttons>\n        </Form>\n      </RTEProvider>\n    </Modal>\n  );\n};\nexport const ErrorBoundary = ErrorReport;\nexport default CreateItem;"],"names":["CreateItem","templateId","useParams","roles","useLoaderData","Modal","children","jsx","RTEProvider","jsxs","Form","method","Input","Hidden","name","value","className","Title","Row","Label","htmlFor","Text","RichText","limit","Select","options","valueKey","Heading","CheckboxGroup","Checkbox","label","Buttons","link","ErrorBoundary","ErrorReport"],"mappings":"24BAwGMA,MAAAA,EAAaA,IAAM,CACjB,KAAA,CAAEC,WAAAA,CAAW,EAAIC,EAAU,EAC3B,CAAEC,MAAAA,CAAM,EAAIC,EAA+C,EAEjE,aACGC,EACC,CAAAC,SAAAC,EAAA,IAACC,GACCF,SAACG,EAAA,KAAAC,EAAA,CAAKC,OAAO,OACXL,SAAA,CAAAC,EAAAA,IAACK,EAAMC,OAAN,CAAaC,KAAK,aAAaC,MAAOd,CAAW,CAAA,EAClDQ,EAAA,KAAC,MAAI,CAAAO,UAAU,8CACbV,SAAA,CAACC,EAAAA,IAAAF,EAAMY,MAAN,CAAYX,SAAe,kBAAA,EAC5BG,EAAAA,KAACC,EAAKQ,IAAL,CACCZ,SAAA,CAACC,EAAA,IAAAY,EAAA,CAAMC,QAAQ,OAAOd,SAAI,OAAA,EACzBC,EAAAA,IAAAK,EAAMS,KAAN,CAAWP,KAAK,MAAO,CAAA,CAAA,EAC1B,EACAL,EAAAA,KAACC,EAAKQ,IAAL,CACCZ,SAAA,CAACC,EAAA,IAAAY,EAAA,CAAMC,QAAQ,cAAcd,SAAW,cAAA,QACvCM,EAAMU,SAAN,CAAeR,KAAK,cAAcS,MAAO,IAAM,CAAA,CAAA,EAClD,EACAd,EAAAA,KAACC,EAAKQ,IAAL,CACCZ,SAAA,CAAAC,EAAA,IAACY,GAAMb,SAAa,gBAAA,EACpBC,EAAAA,IAACK,EAAMY,OAAN,CAAaC,QAAStB,EAAOuB,SAAS,OAAOZ,KAAK,cAAe,CAAA,CAAA,EACpE,EACAL,EAAAA,KAACC,EAAKQ,IAAL,CACCZ,SAAA,CAACC,EAAAA,IAAAY,EAAMQ,QAAN,CAAcrB,SAAS,YAAA,EACxBG,EAAAA,KAACG,EAAMgB,cAAN,CACCtB,SAAA,CAAAC,EAAAA,IAACK,EAAMiB,SAAN,CACCC,MAAM,sCACNhB,KAAK,mBAAkB,EACzBP,EAAAA,IAACK,EAAMiB,SAAN,CACCC,MAAM,8BACNhB,KAAK,mBAAkB,EACzBP,EAAAA,IAACK,EAAMiB,SAAN,CACCC,MAAM,oDACNhB,KAAK,YAAA,CAAY,CAAA,CACrB,CAAA,CAAA,CACF,CAAA,CAAA,EACF,EACAP,EAAAA,IAACF,EAAM0B,QAAN,CAAcC,KAAM,aAAa/B,CAAU,GAAIc,MAAM,SAAST,SAE/D,aAAA,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CACF,CAAA,CAEJ,EACa2B,EAAgBC"}