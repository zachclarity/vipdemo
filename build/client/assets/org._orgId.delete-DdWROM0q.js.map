{"version":3,"file":"org._orgId.delete-DdWROM0q.js","sources":["../../../app/routes/_withNav+/_withSideBar+/_manage+/org.$orgId.delete.tsx"],"sourcesContent":["import ErrorReport from '@components/ui/ErrorReport';\nimport { Input, Label, Form } from '@components/ui';\nimport { Modal } from '@components/ui/modals';\nimport { Attribute } from '@lib/utils';\nimport type { ActionFunctionArgs, LoaderFunctionArgs } from '@remix-run/node';\nimport { json } from '@remix-run/node';\nimport { useLoaderData, useParams } from '@remix-run/react';\nimport { requireUser } from '@services/user.server';\nimport React from 'react';\nimport { AuthorizationError } from 'remix-auth';\nimport { jsonWithError, redirectWithSuccess } from 'remix-toast';\nimport z, { ZodError } from 'zod';\nimport { deleteOrg, getOrg } from './.server/org.queries';\n\nexport const loader = async ({ request, params }: LoaderFunctionArgs) => {\n  await requireUser(request, { permissions: Attribute.ORGS_READWRITEDELETE });\n  const { orgId } = params;\n  if (!orgId) throw json({ status: 'error', error: 'orgId required' });\n  return json({ org: await getOrg(orgId) });\n};\n\n// TODO: Add try catch\nexport async function action({ request, params }: ActionFunctionArgs) {\n  const orgDeleteSchema = z.object({\n    orgId: z.string().min(1),\n  });\n\n  try {\n    await requireUser(request, {\n      options: { redirectOnFailure: false },\n      permissions: Attribute.ORGS_READWRITEDELETE,\n    });\n\n    // const { orgId } = orgDeleteSchema.parse(\n    //   Object.fromEntries((await request.formData()).entries())\n    // );\n    const { orgId } = params;\n\n    await deleteOrg(orgId);\n\n    return redirectWithSuccess('/org', 'Organization Deleted!');\n  } catch (e) {\n    console.error(e);\n\n    if (e instanceof Error) {\n      if (e instanceof AuthorizationError) {\n        return jsonWithError(\n          { status: 'error', error: 'Authorization Error.' },\n          'User is not authorized.'\n        );\n      }\n      if (e instanceof ZodError) {\n        return jsonWithError(\n          { status: 'error', message: 'validation error', errors: e.errors },\n          'There was an error removing the base.'\n        );\n      }\n      return jsonWithError(\n        { status: 'error', message: e.message },\n        'There was an error removing the base.'\n      );\n    }\n  }\n}\n\nconst DeleteOrgDefaultPage = () => {\n  const { org } = useLoaderData<typeof loader>();\n\n  return (\n    <Modal>\n      <Form method=\"POST\">\n        <Input.Hidden name=\"orgId\" value={org?.uuid} />\n        <Modal.Body>\n          <Modal.Title>Delete Organization:</Modal.Title>\n          <Form.Row>\n            <p>\n              Please enter\n              <code className=\"bg-zinc-300 p-1 m-1 rounded-lg py-1\">\n                {org.name}\n              </code>\n              below to confirm the deletion.\n            </p>\n          </Form.Row>\n          <Form.Row>\n            <Label htmlFor=\"orgNameconf1\">Type Organization Name:</Label>\n            <Input.Text\n              type=\"text\"\n              id=\"orgNameconf1\"\n              pattern={org.name}\n              required/>\n          </Form.Row>\n          <Form.Row>\n            <Input.Checkbox\n              name=\"confirm\"\n              label=\"Confirm Organization Deletion\"\n              required/>\n          </Form.Row>\n        </Modal.Body>\n        <Modal.Buttons link=\"/org\" value=\"delete\">\n          Delete\n        </Modal.Buttons>\n      </Form>\n    </Modal>\n  );\n};\nexport const ErrorBoundary = ErrorReport;\nexport default DeleteOrgDefaultPage;\n"],"names":["DeleteOrgDefaultPage","org","useLoaderData","jsx","Modal","children","jsxs","Form","method","Input","Hidden","name","value","uuid","Body","Title","Row","className","Label","htmlFor","Text","type","id","pattern","required","Checkbox","label","Buttons","link","ErrorBoundary","ErrorReport"],"mappings":"k4BAiEMA,MAAAA,EAAuBA,IAAM,CAC3B,KAAA,CAAEC,IAAAA,CAAI,EAAIC,EAA6B,EAE7C,OACGC,EAAAA,IAAAC,EAAA,CACCC,SAACC,EAAA,KAAAC,EAAA,CAAKC,OAAO,OACXH,SAAA,CAAAF,EAAAA,IAACM,EAAMC,OAAN,CAAaC,KAAK,QAAQC,MAAOX,GAAAA,YAAAA,EAAKY,KAAM,EAC7CP,EAAAA,KAACF,EAAMU,KAAN,CACCT,SAAA,CAACF,EAAAA,IAAAC,EAAMW,MAAN,CAAYV,SAAoB,uBAAA,EAChCF,EAAAA,IAAAI,EAAKS,IAAL,CACCX,gBAAC,IAAE,CAAAA,SAAA,CAAA,eAEAF,EAAA,IAAA,OAAA,CAAKc,UAAU,sCACbZ,WAAIM,IACP,CAAA,EAAO,gCAAA,CAET,CAAA,EACF,EACAL,EAAAA,KAACC,EAAKS,IAAL,CACCX,SAAA,CAACF,EAAA,IAAAe,EAAA,CAAMC,QAAQ,eAAed,SAAuB,0BAAA,EACrDF,EAAAA,IAACM,EAAMW,KAAN,CACCC,KAAK,OACLC,GAAG,eACHC,QAAStB,EAAIU,KACba,SAAQ,EAAA,CAAA,CAAA,EACZ,EACArB,EAAAA,IAACI,EAAKS,IAAL,CACCX,SAAAF,EAAAA,IAACM,EAAMgB,SAAN,CACCd,KAAK,UACLe,MAAM,gCACNF,SAAQ,EACZ,CAAA,CAAA,CAAA,CAAA,EACF,EACArB,EAAAA,IAACC,EAAMuB,QAAN,CAAcC,KAAK,OAAOhB,MAAM,SAASP,SAE1C,QAAA,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAEJ,EACawB,EAAgBC"}