{"version":3,"file":"role-dRYFJhF4.js","sources":["../../../app/routes/_withNav+/_withSideBar+/_manage+/role.tsx"],"sourcesContent":["import { LinkButton } from '@components/ui/Buttons';\nimport ErrorReport from '@components/ui/ErrorReport';\nimport PageHeader from '@components/ui/PageHeader';\nimport { Attribute } from '@lib/utils';\nimport { isAdmin, isSuperAdmin } from '@lib/utils/utils.server';\nimport { json, type LoaderFunctionArgs } from '@remix-run/node';\nimport { Outlet, useLoaderData } from '@remix-run/react';\nimport { requireUserAsObject } from '@services/user.server';\nimport { getOrgBeingViewed } from './.server/org.queries';\nimport { getOrgRolesByOrg } from './.server/role.queries';\n\nexport const loader = async ({ request, params }: LoaderFunctionArgs) => {\n  const { currentOrg: org, roles: userRoles } = await requireUserAsObject(\n    request,\n    { permissions: Attribute.ORGS_READ }\n  );\n\n  const { orgBeingViewed } = await getOrgBeingViewed({\n    defaultOrgId: org.uuid,\n    params,\n    searchParams: new URL(request.url).searchParams,\n  });\n\n  const includeSuperAdmin = isSuperAdmin(userRoles);\n  const includeAdmin = isAdmin(userRoles) || includeSuperAdmin;\n\n  const roles = await getOrgRolesByOrg(orgBeingViewed.uuid, { includeAdmin, includeSuperAdmin });\n\n  return json({\n    orgBeingViewed,\n    roles,\n  }, {\n    headers: {\n      'X-Frame-Options': 'SAMEORIGIN',\n    },\n  });\n};\n\nconst ManageRoleIndex = () => {\n  const { roles, orgBeingViewed } = useLoaderData<typeof loader>();\n\n  return (\n    <>\n      <div>\n        <PageHeader org={orgBeingViewed} pageTitle=\"Role Management\" />\n        <LinkButton\n          variant=\"green\"\n          to={`/role/create`}>\n          Add Organizational Role\n        </LinkButton>\n        <div className=\"mt-5\">\n          {roles.length > 0 && (\n            <table className=\"text-left table-auto w-full border-neutral-300 border-1\">\n              <thead>\n                <tr className=\"border-b border-black\">\n                  <th className=\"p-3\">Role:</th>\n                  <th>Email:</th>\n                  <th>Phone:</th>\n                  <th className=\"text-center\">Assigned Users:</th>\n                  <th></th>\n                </tr>\n              </thead>\n              <tbody>\n                {roles\n                  .sort((a, b) => a.role.name.localeCompare(b.role.name))\n                  .map((orgRole) => {\n                    const isAdmin =\n                      orgRole.role.abbreviation === 'SUPERADMIN' ||\n                      orgRole.role.abbreviation === 'ADMIN';\n\n                    return (\n                      <tr\n                        key={orgRole.uuid}\n                        className=\"table-row border-b even:bg-zinc-50\">\n                        <td className=\"p-3\">{orgRole.role.name}</td>\n                        <td>{!isAdmin && orgRole.contactEmail}</td>\n                        <td>{!isAdmin && orgRole.contactPhone}</td>\n                        <td className=\"text-center\">{orgRole._count.users}</td>\n                        <td className=\"text-right pr-5 gap-x-3 space-x-2\">\n                          <LinkButton\n                            to={`/role/${orgRole.uuid}/users`}>\n                            Users\n                          </LinkButton>\n                          {!isAdmin && (\n                            <>\n                              <LinkButton\n                                variant=\"gray\"\n                                to={`/role/${orgRole.uuid}/edit`}>\n                                Edit\n                              </LinkButton>\n                              <LinkButton\n                                variant=\"red\"\n                                to={`/role/${orgRole.uuid}/delete`}>\n                                Delete\n                              </LinkButton>\n                            </>\n                          )}\n                        </td>\n                      </tr>\n                    );\n                  })}\n              </tbody>\n            </table>\n          )}\n          {roles.length === 0 && <p>No roles found.</p>}\n        </div>\n      </div>\n      <Outlet context={{orgBeingViewed}}/>\n    </>\n  );\n};\n\nexport const ErrorBoundary = ErrorReport;\nexport default ManageRoleIndex;\n"],"names":["ManageRoleIndex","roles","orgBeingViewed","useLoaderData","jsxs","Fragment","children","jsx","PageHeader","org","pageTitle","LinkButton","variant","to","className","length","sort","a","b","role","name","localeCompare","map","orgRole","isAdmin","abbreviation","contactEmail","contactPhone","_count","users","uuid","Outlet","context","ErrorBoundary","ErrorReport"],"mappings":"03BAsCMA,MAAAA,EAAkBA,IAAM,CAC5B,KAAM,CAAEC,MAAAA,EAAOC,eAAAA,CAAe,EAAIC,EAA6B,EAE/D,OAEIC,EAAAA,KAAAC,EAAAA,SAAA,CAAAC,SAAA,CAAAF,EAAA,KAAC,MACC,CAAAE,SAAA,CAAAC,EAAA,IAACC,EAAW,CAAAC,IAAKP,EAAgBQ,UAAU,iBAAkB,CAAA,EAC7DH,EAAA,IAACI,EAAA,CACCC,QAAQ,QACRC,GAAI,eAAgBP,SAAA,yBAAA,CAEtB,EACAF,EAAA,KAAC,MAAI,CAAAU,UAAU,OACZR,SAAA,CAAAL,EAAMc,OAAS,GACbX,EAAAA,KAAA,QAAA,CAAMU,UAAU,0DACfR,SAAA,CAAAC,EAAA,IAAC,QACC,CAAAD,SAAAF,EAAA,KAAC,KAAG,CAAAU,UAAU,wBACZR,SAAA,CAACC,EAAA,IAAA,KAAA,CAAGO,UAAU,MAAMR,SAAK,OAAA,CAAA,EACzBC,EAAA,IAAC,MAAGD,SAAM,QAAA,CAAA,EACVC,EAAA,IAAC,MAAGD,SAAM,QAAA,CAAA,EACTC,EAAA,IAAA,KAAA,CAAGO,UAAU,cAAcR,SAAe,kBAAA,QAC1C,KAAG,EAAA,CAAA,CACN,CAAA,CACF,CAAA,QACC,QACE,CAAAA,SAAAL,EACEe,KAAK,CAACC,EAAGC,IAAMD,EAAEE,KAAKC,KAAKC,cAAcH,EAAEC,KAAKC,IAAI,CAAC,EACrDE,IAAKC,GAAY,CAChB,MAAMC,EACJD,EAAQJ,KAAKM,eAAiB,cAC9BF,EAAQJ,KAAKM,eAAiB,QAG9B,OAAArB,EAAAA,KAAC,KAAA,CAECU,UAAU,qCACVR,SAAA,CAAAC,EAAA,IAAC,KAAG,CAAAO,UAAU,MAAOR,SAAAiB,EAAQJ,KAAKC,IAAK,CAAA,EACtCb,EAAA,IAAA,KAAA,CAAID,SAACkB,CAAAA,GAAWD,EAAQG,YAAa,CAAA,EACrCnB,EAAA,IAAA,KAAA,CAAID,SAACkB,CAAAA,GAAWD,EAAQI,YAAa,CAAA,QACrC,KAAG,CAAAb,UAAU,cAAeR,SAAAiB,EAAQK,OAAOC,KAAM,CAAA,EAClDzB,EAAA,KAAC,KAAG,CAAAU,UAAU,oCACZR,SAAA,CAAAC,EAAA,IAACI,EAAA,CACCE,GAAI,SAASU,EAAQO,IAAI,SAAUxB,SAAA,OAErC,CAAA,EACC,CAACkB,GAEEpB,EAAA,KAAAC,WAAA,CAAAC,SAAA,CAAAC,EAAA,IAACI,EAAA,CACCC,QAAQ,OACRC,GAAI,SAASU,EAAQO,IAAI,QAASxB,SAAA,MAAA,CAEpC,EACAC,EAAA,IAACI,EAAA,CACCC,QAAQ,MACRC,GAAI,SAASU,EAAQO,IAAI,UAAWxB,SAAA,QAAA,CAEtC,CAAA,CACF,CAAA,CAAA,CAEJ,CAAA,CAAA,CAAA,EAzBKiB,EAAQO,IA0Bf,CAEH,CAAA,CACL,CAAA,CAAA,CACF,CAAA,EAED7B,EAAMc,SAAW,GAAKR,EAAAA,IAAC,KAAED,SAAe,iBAAA,CAAA,CAAA,CAC3C,CAAA,CAAA,CACF,CAAA,EACCC,EAAA,IAAAwB,EAAA,CAAOC,QAAS,CAAC9B,eAAAA,CAAc,CAAE,CAAA,CAAA,CACpC,CAAA,CAEJ,EAEa+B,EAAgBC"}