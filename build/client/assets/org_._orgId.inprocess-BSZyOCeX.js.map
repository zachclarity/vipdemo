{"version":3,"file":"org_._orgId.inprocess-BSZyOCeX.js","sources":["../../../node_modules/@heroicons/react/16/solid/esm/CloudArrowDownIcon.js","../../../app/routes/_withNav+/_withSideBar+/_manage+/org_.$orgId.inprocess.tsx"],"sourcesContent":["import * as React from \"react\";\nfunction CloudArrowDownIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 16 16\",\n    fill: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    d: \"M4.5 13a3.5 3.5 0 0 1-1.41-6.705A3.5 3.5 0 0 1 9.72 4.124a2.5 2.5 0 0 1 3.197 3.018A3.001 3.001 0 0 1 12 13H4.5Zm6.28-3.97a.75.75 0 1 0-1.06-1.06l-.97.97V6.25a.75.75 0 0 0-1.5 0v2.69l-.97-.97a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.06 0l2.25-2.25Z\",\n    clipRule: \"evenodd\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(CloudArrowDownIcon);\nexport default ForwardRef;","import {\n  DeleteButton,\n  LinkButton,\n  PauseButton,\n  PlayButton,\n} from '@components/ui/Buttons';\nimport ErrorReport from '@components/ui/ErrorReport';\nimport PageHeader from '@components/ui/PageHeader';\nimport type { ChecklistType } from '@lib/constants';\nimport { Attribute } from '@lib/utils';\nimport type { ActionFunctionArgs, LoaderFunctionArgs } from '@remix-run/node';\nimport { json } from '@remix-run/node';\nimport { useFetcher, useLoaderData } from '@remix-run/react';\nimport { requireUser, requireUserAsObject } from '@services/user.server';\nimport {\n  getInprocessingMembers,\n  getOrgBeingViewed,\n} from './.server/org.queries';\nimport {\n  ArchiveBoxArrowDownIcon,\n  EyeIcon,\n  PauseIcon,\n  PlayIcon,\n} from '@heroicons/react/24/outline';\nimport { AuthorizationError } from 'remix-auth';\nimport { jsonWithSuccess, jsonWithError } from 'remix-toast';\nimport { z } from 'zod';\nimport {\n  pauseChecklist,\n  resumeChecklist,\n  archiveChecklist,\n} from '../.server/tasks.queries';\nimport type { Checklist} from '@prisma/client';\nimport { ChecklistStatus } from '@prisma/client';\nimport { Input } from '@components/ui';\nimport { CloudArrowDownIcon } from '@heroicons/react/16/solid';\n\nexport const loader = async ({ request, params }: LoaderFunctionArgs) => {\n  const { currentOrg } = await requireUserAsObject(request, {\n    permissions: Attribute.MOVES_READ,\n  });\n\n  const { orgId } = params;\n\n  if (!orgId) throw new Error('org id is required.');\n\n  const inbound = await getInprocessingMembers(orgId);\n  const { orgBeingViewed } = await getOrgBeingViewed({\n    defaultOrgId: currentOrg.uuid,\n    searchParams: new URL(request.url).searchParams,\n    params,\n  });\n\n  return json({\n    inbound,\n    orgBeingViewed,\n  });\n};\n\nexport async function action({ request }: ActionFunctionArgs) {\n  const updateTaskSchema = z.object({\n    itemId: z.string(),\n    _action: z.union([\n      z.literal('pause'),\n      z.literal('resume'),\n      z.literal('archive'),\n    ]),\n  });\n\n  try {\n    const approvedUserId = await requireUser(request, {\n      options: { redirectOnFailure: false },\n      permissions: Attribute.TASKS_READWRITE,\n    });\n\n    const { itemId, _action } = updateTaskSchema.parse(\n      Object.fromEntries((await request.formData()).entries())\n    );\n\n    if (_action === 'pause') {\n      await pauseChecklist(itemId, approvedUserId);\n      return jsonWithSuccess({ status: 'success' }, 'Checklist Paused');\n    }\n    if (_action === 'resume') {\n      await resumeChecklist(itemId, approvedUserId);\n      return jsonWithSuccess({ status: 'success' }, 'Checklist Resumed');\n    }\n    if (_action === 'archive') {\n      await archiveChecklist(itemId, approvedUserId);\n      return jsonWithError({ status: 'success' }, 'Checklist Archived!');\n    }\n  } catch (error) {\n    console.error('Error during approval: ', error);\n    if (error instanceof Error) {\n      if (error instanceof AuthorizationError) {\n        return jsonWithError(\n          { status: 'error', error: 'Authorization Error.' },\n          'User is not authorized.'\n        );\n      }\n      return jsonWithError(\n        { status: 'error', error: 'Failed to perform requested action' },\n        'There was an error.'\n      );\n    }\n  }\n}\n\nconst convertToCSV = (\n  data: {\n    name: string;\n    checklist: Checklist & {\n      type: ChecklistType;\n      count: { totalItems: number; completedItems: number };\n    };\n  }[]\n) => {\n  const headers = [\n    'Name',\n    'Status',\n    'Type',\n    'Checklist Progress',\n    'Last Updated',\n  ];\n  const rows = data.map(({ checklist: { count, ...checklist }, ...user }) => {\n    const updatedAt = checklist.updatedAt\n      ? new Date(checklist.updatedAt).toDateString()\n      : 'N/A';\n\n    let status = 'Unkown';\n    switch (checklist.status) {\n      case 'Archived':\n        status = 'Archived';\n        break;\n      case 'InProgress':\n        status = 'In Progress';\n        break;\n      case 'Paused':\n        status = 'Paused';\n        break;\n    }\n\n    const totalItems = count.totalItems || 0;\n    const completedItems = count.completedItems || 0;\n    const progress =\n      totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;\n\n    return [\n      user.name || 'Unknown',\n      status,\n      checklist.type || 'N/A',\n      `${progress}%`,\n      updatedAt,\n    ].join(',');\n  });\n\n  return [headers.join(','), ...rows].join('\\n');\n};\n\nconst downloadCSV = (data: any[], filename = 'checklist.csv') => {\n  if (!data || data.length === 0) {\n    console.error('No data to export.');\n    return;\n  }\n\n  const csvContent = convertToCSV(data);\n  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n  const url = URL.createObjectURL(blob);\n\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  link.style.visibility = 'hidden';\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n};\n\nconst InProcessingMembers = () => {\n  const { inbound, orgBeingViewed } = useLoaderData<typeof loader>();\n  const fetcher = useFetcher();\n\n  return (\n    <>\n      <PageHeader\n        org={orgBeingViewed}\n        pageTitle=\"Inprocessing Members\"\n        navigateTo=\"inprocess\"/>\n\n      {inbound.length > 0 ? (\n        <>\n          <div className=\"w-full flex justify-end\">\n            <button\n              type=\"button\"\n              onClick={() => downloadCSV(inbound)}\n              className={`inline-flex justify-right px-4 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white`}>\n              <CloudArrowDownIcon className=\"w-5 h-5 mr-2\" />\n              Export\n            </button>\n          </div>\n\n          <table className=\"text-left table-auto w-full border-neutral-300 border-1\">\n            <thead>\n              <tr className=\"border-b border-black\">\n                <th></th>\n                <th className=\"text-left\">Name</th>\n                <th>Status</th>\n                <th>Type</th>\n                <th className=\"text-center\">Checklist Progress</th>\n                <th className=\"w-56\">Last Updated</th>\n                <th className=\"w-56\"></th>\n              </tr>\n            </thead>\n            <tbody>\n              {inbound\n                .sort((a, b) => a.name.localeCompare(b.name))\n                .map((user) => {\n                  const updatedAt = new Date(\n                    user.checklist.updatedAt\n                  ).toDateString();\n                  const percentage = Math.round(\n                    (user.checklist.count.completedItems /\n                    user.checklist.count.totalItems) *\n                    100\n                  );\n\n                  return (\n                    <tr\n                      key={user.id}\n                      className=\"table-row border-b even:bg-zinc-50\">\n                      <td className=\"w-5 px-2\">\n                        {user.checklist.status === ChecklistStatus.Paused ? (\n                          <PauseIcon className=\"h-5 w-5\" />\n                        ) : (\n                          <PlayIcon className=\"h-5 w-5\" />\n                        )}\n                      </td>\n                      <td className=\"py-2\">{user.name}</td>\n                      <td>\n                        {user.checklist.status === ChecklistStatus.Archived &&\n                        'Archived'}\n                        {user.checklist.status === ChecklistStatus.InProgress &&\n                        'In Progress'}\n                        {user.checklist.status === ChecklistStatus.Paused &&\n                        'Paused'}\n                      </td>\n                      <td>{user.checklist.type}</td>\n                      <td className=\"text-center\">\n                        {Number.isNaN(percentage) ? '0%' : `${percentage}%`}\n                      </td>\n                      <td>{updatedAt}</td>\n                      <td className=\"text-right flex gap-2 mt-1\">\n                        <fetcher.Form method=\"POST\" className=\"flex gap-2\">\n                          <Input.Hidden\n                            name=\"itemId\"\n                            value={user.checklist.id}></Input.Hidden>\n                          {user.checklist.status !== ChecklistStatus.Paused ? (\n                            <PauseButton\n                              type=\"submit\"\n                              value=\"pause\"\n                              name=\"_action\"\n                              className=\"flex justify-center items-center w-12\">\n                              <PauseIcon className=\"h-5 w-5\" />\n                            </PauseButton>\n                          ) : (\n                            <PlayButton\n                              type=\"submit\"\n                              value=\"resume\"\n                              name=\"_action\"\n                              className=\"flex justify-center items-center w-12\">\n                              <PlayIcon className=\"h-5 w-5\" />\n                            </PlayButton>\n                          )}\n                          <DeleteButton\n                            type=\"submit\"\n                            value=\"archive\"\n                            name=\"_action\"\n                            className=\"flex justify-center items-center w-12\">\n                            <ArchiveBoxArrowDownIcon className=\"h-5 w-5\" />\n                          </DeleteButton>\n                        </fetcher.Form>\n                        <LinkButton\n                          to={`/org/${orgBeingViewed.uuid}/inprocess/${user.checklist.id}/view`}\n                          className=\"flex justify-center items-center w-12\">\n                          <EyeIcon className=\"h-5 w-5\" />\n                        </LinkButton>\n                      </td>\n                    </tr>\n                  );\n                })}\n            </tbody>\n          </table>\n        </>\n      ) : (\n        `No members to show.`\n      )}\n    </>\n  );\n};\n\nexport const ErrorBoundary = ErrorReport;\nexport default InProcessingMembers;\n"],"names":["CloudArrowDownIcon","title","titleId","props","svgRef","React.createElement","ForwardRef","React.forwardRef","convertToCSV","data","headers","rows","map","checklist","count","user","updatedAt","Date","toDateString","status","totalItems","completedItems","progress","Math","round","name","type","join","downloadCSV","filename","length","console","error","csvContent","blob","Blob","url","URL","createObjectURL","link","document","createElement","href","download","style","visibility","body","appendChild","click","removeChild","InProcessingMembers","inbound","orgBeingViewed","useLoaderData","fetcher","useFetcher","jsxs","Fragment","children","jsx","PageHeader","org","pageTitle","navigateTo","className","onClick","sort","a","b","localeCompare","percentage","ChecklistStatus","Paused","PauseIcon","PlayIcon","Archived","InProgress","Number","isNaN","Form","method","Input","Hidden","value","id","PauseButton","PlayButton","DeleteButton","ArchiveBoxArrowDownIcon","LinkButton","to","uuid","EyeIcon","ErrorBoundary","ErrorReport"],"mappings":"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","x_google_ignoreList":[0]}